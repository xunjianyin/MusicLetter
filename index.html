<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <meta name="description" content="Interactive typography that converts your typing into beautiful animations with musical feedback" />
    <meta name="keywords" content="music, typography, animation, interactive, creative, web app" />
    <meta name="author" content="Music Letter" />
    <meta name="theme-color" content="#7a5cff" />
    
    <meta name="preload" content="fonts" />
    <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
    <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    
    <title>Music Letter - Interactive Typography with Sound</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Playfair+Display:wght@400;600&family=EB+Garamond:wght@400;600&family=Merriweather:wght@400;700&family=Lora:wght@400;600&family=Cormorant+Garamond:wght@400;600&family=DM+Serif+Display&family=Libre+Baskerville:wght@400;700&family=Great+Vibes&family=Pacifico&family=Dancing+Script:wght@400;600&family=Cinzel+Decorative:wght@400;700&family=Playball&family=Lobster&family=Sacramento&family=Amatic+SC:wght@400;700&family=Caveat:wght@400;600&family=Abril+Fatface&family=Berkshire+Swash&family=Shadows+Into+Light&family=Indie+Flower&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css?v=9" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/MotionPathPlugin.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/tone@14.8.49/build/Tone.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.1/lame.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/browser-id3-writer@4.1.0/dist/browser-id3-writer.min.js" defer></script>
    <script src="./app.js?v=11" defer></script>
  </head>
  <body>
    <a href="#letterSheet" class="skip-link">Skip to main content</a>
    <div class="controls collapsed" id="controls" role="toolbar" aria-label="Application controls and settings">
      <button id="controlsToggle" class="controls-toggle" aria-label="Toggle controls panel" aria-expanded="false" title="Show/hide controls">
        <span aria-hidden="true">✉️</span>
        <span class="sr-only">Toggle Controls</span>
      </button>
      <div class="controls-content">
      <div class="left-controls">
        <label for="themeSelect">Theme</label>
        <select id="themeSelect" aria-label="Select theme">
          <option value="classic">Classic</option>
          <option value="midnight">Midnight</option>
          <option value="pastel">Pastel</option>
        </select>
        <label for="patternSelect">Pattern</label>
        <select id="patternSelect" aria-label="Select pattern">
          <option value="plain">Plain</option>
          <option value="lined">Lined</option>
          <option value="dotted">Dotted</option>
          <option value="grid">Grid</option>
          <option value="vintage">Vintage</option>
          <option value="watercolor">Watercolor</option>
          <option value="marble">Marble</option>
          <option value="parchment">Parchment</option>
        </select>
        <label>Font</label>
        <div class="font-picker" id="fontPicker">
          <button id="fontPickerBtn" class="picker-btn" aria-haspopup="listbox" aria-expanded="false">Pacifico</button>
          <ul id="fontPickerList" class="picker-list" role="listbox" tabindex="-1" aria-label="Select font">
            <li role="option" data-font="Playfair Display" style="font-family:'Playfair Display',serif">Playfair Display</li>
            <li role="option" data-font="Poppins" style="font-family:Poppins,sans-serif">Poppins</li>
            <li role="option" data-font="EB Garamond" style="font-family:'EB Garamond',serif">EB Garamond</li>
            <li role="option" data-font="Merriweather" style="font-family:Merriweather,serif">Merriweather</li>
            <li role="option" data-font="Lora" style="font-family:Lora,serif">Lora</li>
            <li role="option" data-font="Cormorant Garamond" style="font-family:'Cormorant Garamond',serif">Cormorant Garamond</li>
            <li role="option" data-font="DM Serif Display" style="font-family:'DM Serif Display',serif">DM Serif Display</li>
            <li role="option" data-font="Libre Baskerville" style="font-family:'Libre Baskerville',serif">Libre Baskerville</li>
            <li role="option" data-font="Great Vibes" style="font-family:'Great Vibes',cursive">Great Vibes</li>
            <li role="option" data-font="Pacifico" style="font-family:Pacifico,cursive">Pacifico</li>
            <li role="option" data-font="Dancing Script" style="font-family:'Dancing Script',cursive">Dancing Script</li>
            <li role="option" data-font="Cinzel Decorative" style="font-family:'Cinzel Decorative',serif">Cinzel Decorative</li>
            <li role="option" data-font="Playball" style="font-family:Playball,cursive">Playball</li>
            <li role="option" data-font="Lobster" style="font-family:Lobster,cursive">Lobster</li>
            <li role="option" data-font="Sacramento" style="font-family:Sacramento,cursive">Sacramento</li>
            <li role="option" data-font="Amatic SC" style="font-family:'Amatic SC',cursive">Amatic SC</li>
            <li role="option" data-font="Caveat" style="font-family:Caveat,cursive">Caveat</li>
            <li role="option" data-font="Abril Fatface" style="font-family:'Abril Fatface',serif">Abril Fatface</li>
            <li role="option" data-font="Berkshire Swash" style="font-family:'Berkshire Swash',cursive">Berkshire Swash</li>
            <li role="option" data-font="Shadows Into Light" style="font-family:'Shadows Into Light',cursive">Shadows Into Light</li>
            <li role="option" data-font="Indie Flower" style="font-family:'Indie Flower',cursive">Indie Flower</li>
          </ul>
        </div>
        <label for="paletteSelect">Palette</label>
        <select id="paletteSelect" aria-label="Select sound palette">
          <option value="majorC">C Major</option>
          <option value="minorA">A Minor</option>
          <option value="pentatonicC">C Pentatonic</option>
        </select>
        <label for="alignSelect">Align</label>
        <select id="alignSelect" aria-label="Text alignment">
          <option value="left">Left</option>
          <option value="center">Center</option>
          <option value="right">Right</option>
          <option value="justify">Justify</option>
        </select>
        <label for="playheadSelect">Playhead</label>
        <select id="playheadSelect" aria-label="Playhead style">
          <option value="classic">Classic Ball</option>
          <option value="comet">Glow Comet</option>
          <option value="star">Star</option>
          <option value="heart">Heart</option>
          <option value="flame">Flame</option>
          <option value="kitten">Kitten</option>
          <option value="diamond">Diamond</option>
        </select>
      </div>
      <div class="right-controls">
        <div class="control-row">
            <button id="playBtn" aria-label="Play sequence" title="Play the typed sequence with animation">
                Play
            </button>
            <button id="clearBtn" aria-label="Clear all text" title="Clear all typed content">
                Clear
            </button>
        </div>
        <div class="control-row">
            <label for="soundSelect" class="control-label">Sound</label>
            <select id="soundSelect" aria-label="Sound preset">
                <option value="sine_soft">Sine Soft</option>
                <option value="triangle_ambient">Triangle Ambient</option>
                <option value="chime_fm">Chime FM</option>
                <option value="pluck">Pluck</option>
                <option value="saw_pad">Saw Pad</option>
                <option value="epiano">E-Piano</option>
                <option value="bell">Bell</option>
            </select>
        </div>
        <div class="control-row-sliders">
            <div>
                <label for="volumeRange" class="control-label">Vol</label>
                <input id="volumeRange" type="range" min="-36" max="0" step="1" value="-12" aria-label="Master volume (dB)" />
            </div>
            <div>
                <label for="elasticityRange" class="control-label">Bounce</label>
                <input id="elasticityRange" type="range" min="0" max="1" step="0.1" value="0.8" aria-label="Playhead elasticity" />
            </div>
            <div>
                <label for="timingRange" class="control-label">Tempo</label>
                <input id="timingRange" type="range" min="0.5" max="3.0" step="0.1" value="1.0" aria-label="Playback timing" />
            </div>
        </div>
        <div class="control-row-file-ops">
            <div>
                <button id="exportJsonBtn" aria-label="Export JSON">Export JSON</button>
                <button id="exportWavBtn" aria-label="Export WAV">Export WAV</button>
                <button id="exportMp3Btn" aria-label="Export MP3">Export MP3</button>
            </div>
            <div>
                <button id="exportLrcBtn" aria-label="Export LRC">Export LRC</button>
                <button id="importBtn" aria-label="Import JSON">Import</button>
                <input id="importFile" type="file" accept="application/json" style="display:none" />
            </div>
        </div>
      </div>
      </div>
    </div>

    <main class="stage" role="main">
      <section id="letterSheet" class="letter-sheet" aria-label="Interactive typing area" tabindex="0" role="textbox" aria-multiline="true" aria-describedby="instructions">
        <div id="textArea" class="text-area" aria-live="polite" aria-atomic="false"></div>
        <div id="instructions" class="sr-only">
          Start typing to create animated letters with musical notes. Use backspace to delete, enter for new lines. 
          Click the controls button to adjust themes, fonts, and export options.
        </div>
        <div id="trailLayer" class="trail-layer" aria-hidden="true"></div>
        <div id="ball" class="ball" aria-hidden="true"></div>
      </section>
    </main>
    
    <div id="loadingIndicator" class="loading-indicator" aria-hidden="true">
      <div class="loading-spinner"></div>
      <p>Loading Music Letter...</p>
    </div>
    
    <div id="errorNotification" class="error-notification" role="alert" aria-live="assertive" aria-atomic="true" style="display: none;">
      <p id="errorMessage"></p>
      <button id="dismissError" aria-label="Dismiss error">×</button>
    </div>
  </body>
</html>